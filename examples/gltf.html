<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>Example</title>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300,600' rel='stylesheet' type='text/css'>
    <link href="https://fonts.googleapis.com/css?family=Material+Icons|Material+Icons+Outlined|Material+Icons+Two+Tone|Material+Icons+Round|Material+Icons+Sharp" rel="stylesheet">
    
    <link rel="stylesheet" href="../css/metadata.css"/>
    <link rel="stylesheet" href="../css/tree.css"/>
    
    <script async src="https://unpkg.com/es-module-shims@1.3.6/dist/es-module-shims.js"></script>

    <script type="importmap">
    {
        "imports": {
            "three": "../bimsurfer/lib/three/r140/three.module.js"
        }
    }
    </script>

    <script type="module">
        import MultiModal from "../bimsurfer/src/MultiModal.js"
        
        let processed = false;

        document.addEventListener("DOMContentLoaded", () => {
            if (processed) {
                // For some reason the event fires twice with es-module-shims on chrome
                return;
            }            
            processed = true;

            var modelName = window.location.hash;
            if (modelName.length < 1) {
                modelName = "Duplex_A_20110907_optimized";
            } else {
                modelName = modelName.substr(1);
            }
            modelName = "models/" + modelName;
            
            var v = window.viewer = new MultiModal({
                domNode: 'viewerContainer',
                modelPath: modelName,
                withTreeVisibilityToggle: true,
                withTreeViewIcons: true
            });
            
            v.load3d();
            v.loadMetadata('dataContainer');
            v.loadTreeView('treeContainer');            
        });
        
        window.onkeypress = (evt) => {
            if (evt.key === 'h') {
                viewer.setVisibility({ids: viewer.getSelection(), visible: false});
            } else if (evt.key === 'H') {
                viewer.setVisibility({reset: true});
            } else if (evt.key === 'x') {
                const ids = viewer.getSelection();
                viewer.reset({selection: true});
                viewer.setColor({ids: ids, color: {r: 0., g: 1., b: 1.}, highlight: true});
            } else if (evt.key === 'X') {
                viewer.reset({colors: true});
            }
        }

        window.onresize = (evt) => {
            viewer.resize();
        }
    </script>
    <style>
      html, body {
          padding: 0;
          margin: 0;
          height: 100%;
          font-family: 'Open Sans';
          overflow: hidden;
      } 
      body {
          display: flex;
          flex-direction: column;
      }
      h1 {
          flex: 0 0 50px;
          padding: 0;
          margin: 0;
      }
      div {
          box-sizing: border-box;
      }
      #columns {
          display: flex;
          flex:1;
          flex-grow: 1;
          height: 1px;
      }
      #viewerContainer {
          flex: 1 1;
      }
      #treeContainer {
          flex: 0 0 25%;
          overflow-y: scroll;
      }
      #dataContainer { 
          flex: 0 0 25%;
          overflow-y: scroll;
      }
      canvas {
          width: 100%;
          height: 100%;
      }
    </style>
</head>
<body>

<h1>BIMsurfer v2.1 demo</h1>

<div id="columns">
    <div id="treeContainer" class="bimsurfer-static-tree"></div>
    <div id="viewerContainer"></div>
    <div id="dataContainer" class="bimsurfer-metadata"></div>
</div>

</body>
</html>